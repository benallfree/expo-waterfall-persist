"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var expo=require("expo"),baseCreateStore=_interopDefault(require("react-waterfall")),_=_interopDefault(require("lodash"));function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),o.forEach(function(t){_defineProperty(e,t,r[t])})}return e}function createStoreAsync(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o={Log:{debug:function(){console.log.apply(null,arguments)},error:function(){console.error.apply(null,arguments)}},fileUri:"".concat(expo.FileSystem.documentDirectory,"/state.json"),debounce:{wait:250,maxWait:1e3},onSaveError:function(e){throw t.Log.error(e),e},onLoadError:function(e){throw t.Log.error(e),e}},n=_.merge({},o,r);return new Promise(function(t,r){var o=n.fileUri,i=n.Log,a=n.onLoadError,c=n.onSaveError;i.debug("Loading state from ".concat(o)),new Promise(function(t,r){expo.FileSystem.readAsStringAsync(o).then(function(r){var o=JSON.parse(r);o&&o.version==e.initialState.version?(i.debug("State restored",o),e.initialState=_objectSpread({},o)):i.debug("State verison differs (".concat(o.version," vs ").concat(e.initialState.version,", discarding.")),t(e)}).catch(function(r){"E_FILE_NOT_READ"===r.code?i.debug("No saved state found, using defaults."):a(r),t(e)})}).then(function(e){var r=_.merge({},e.initialState);i.debug("Waterfall Config",e);var a=baseCreateStore(e),u=_.debounce(function(){expo.FileSystem.writeAsStringAsync(o,JSON.stringify(r)).then(function(){i.debug("State persisted",r)}).catch(c)},n.debounce.wait,{maxWait:n.debounce.maxWait});a.subscribe(function(e,t){i.debug("saved to mirror",t),_.merge(r,t),u()}),t(a)})})}exports.createStoreAsync=createStoreAsync;
//# sourceMappingURL=expo-waterfall-persist.min.js.map
